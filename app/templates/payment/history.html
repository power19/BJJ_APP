{% extends "base.html" %}

{% block title %}Payment History{% endblock %}
{% block nav_title %}History{% endblock %}

{% block content %}
<div class="page-container">
    <!-- Header -->
    <div class="page-header">
        <p class="date-range">{{ start_date }} - {{ end_date }}</p>
    </div>

    <!-- Filter -->
    <form method="get" class="filter-form card">
        <select id="days" name="days" class="filter-select">
            <option value="7" {% if days == 7 %}selected{% endif %}>Last 7 days</option>
            <option value="30" {% if days == 30 %}selected{% endif %}>Last 30 days</option>
            <option value="90" {% if days == 90 %}selected{% endif %}>Last 90 days</option>
            <option value="180" {% if days == 180 %}selected{% endif %}>Last 6 months</option>
        </select>
    </form>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="/api/v1/payment/handover/dashboard" class="btn btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.25 4.533A9.707 9.707 0 006 3a9.735 9.735 0 00-3.25.555.75.75 0 00-.5.707v14.25a.75.75 0 001 .707A8.237 8.237 0 016 18.75c1.995 0 3.823.707 5.25 1.886V4.533zM12.75 20.636A8.214 8.214 0 0118 18.75c.966 0 1.89.166 2.75.47a.75.75 0 001-.708V4.262a.75.75 0 00-.5-.707A9.735 9.735 0 0018 3a9.707 9.707 0 00-5.25 1.533v16.103z" />
            </svg>
            Dashboard
        </a>
        <a href="/api/v1/payment" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd" d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z" clip-rule="evenodd" />
            </svg>
            New Payment
        </a>
    </div>

    <!-- Payments List -->
    {% if payments %}
    <div class="payment-list">
        {% for payment in payments %}
        <div class="history-card">
            <div class="history-header">
                <div class="history-customer">{{ payment.customer_name }}</div>
                <div class="history-amount">SRD {{ "%.2f"|format(payment.amount) }}</div>
            </div>

            <div class="history-meta">
                <div class="history-detail">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M6.75 2.25A.75.75 0 017.5 3v1.5h9V3A.75.75 0 0118 3v1.5h.75a3 3 0 013 3v11.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V7.5a3 3 0 013-3H6V3a.75.75 0 01.75-.75zm13.5 9a1.5 1.5 0 00-1.5-1.5H5.25a1.5 1.5 0 00-1.5 1.5v7.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5v-7.5z" clip-rule="evenodd" />
                    </svg>
                    <span>{{ payment.date }}</span>
                </div>
                <div class="history-detail">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z" clip-rule="evenodd" />
                    </svg>
                    <span>{{ payment.received_by }}</span>
                </div>
            </div>

            <div class="history-status-row">
                {% if payment.status == 'transferred' %}
                    <span class="status-badge status-transferred">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                        </svg>
                        Transferred
                    </span>
                    <span class="transfer-info">to {{ payment.transferred_to }}</span>
                {% elif payment.status == 'pending' %}
                    <span class="status-badge status-pending">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z" clip-rule="evenodd" />
                        </svg>
                        Pending
                    </span>
                {% else %}
                    <span class="status-badge status-completed">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                        </svg>
                        Completed
                    </span>
                {% endif %}
            </div>

            <div class="history-actions">
                <a href="/api/v1/payment/history/details/{{ payment.payment_id }}" class="btn btn-secondary btn-sm">
                    View Details
                </a>
                {% if payment.status == 'pending' and payment.received_by_role == "Coach" %}
                <a href="/api/v1/payment/handover/process/{{ payment.payment_id }}" class="btn btn-success btn-sm">
                    Transfer
                </a>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state card">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M5.625 1.5H9a3.75 3.75 0 013.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 013.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 01-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875zm6.905 9.97a.75.75 0 00-1.06 0l-3 3a.75.75 0 101.06 1.06l1.72-1.72V18a.75.75 0 001.5 0v-4.19l1.72 1.72a.75.75 0 101.06-1.06l-3-3z" clip-rule="evenodd" />
            <path d="M14.25 5.25a5.23 5.23 0 00-1.279-3.434 9.768 9.768 0 016.963 6.963A5.23 5.23 0 0016.5 7.5h-1.875a.375.375 0 01-.375-.375V5.25z" />
        </svg>
        <h3>No Payments Found</h3>
        <p>No payments have been processed during this period.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block styles %}
<style>
    .page-header {
        margin-bottom: 1rem;
    }

    .date-range {
        color: #94a3b8;
        font-size: 0.875rem;
    }

    .filter-form {
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .filter-select {
        width: 100%;
        padding: 0.75rem 1rem;
        background: rgba(15, 23, 42, 0.6);
        border: 2px solid #334155;
        border-radius: 12px;
        font-size: 1rem;
        color: #f8fafc;
        font-family: inherit;
        cursor: pointer;
    }

    .filter-select:focus {
        outline: none;
        border-color: #3b82f6;
    }

    .filter-select option {
        background: #1e293b;
        color: #f8fafc;
    }

    .action-buttons {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }

    .action-buttons .btn {
        font-size: 0.875rem;
        padding: 0.75rem 1rem;
    }

    .payment-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .history-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(71, 85, 105, 0.4);
        border-radius: 16px;
        padding: 1.25rem;
    }

    .history-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
    }

    .history-customer {
        font-size: 1rem;
        font-weight: 600;
        color: #f8fafc;
    }

    .history-amount {
        font-size: 1.125rem;
        font-weight: 700;
        color: #34d399;
    }

    .history-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 0.75rem;
    }

    .history-detail {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        font-size: 0.8125rem;
        color: #94a3b8;
    }

    .history-detail svg {
        width: 14px;
        height: 14px;
        color: #64748b;
    }

    .history-status-row {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.25rem 0.625rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-badge svg {
        width: 12px;
        height: 12px;
    }

    .status-transferred {
        background: rgba(16, 185, 129, 0.15);
        color: #34d399;
    }

    .status-pending {
        background: rgba(251, 191, 36, 0.15);
        color: #fbbf24;
    }

    .status-completed {
        background: rgba(59, 130, 246, 0.15);
        color: #60a5fa;
    }

    .transfer-info {
        font-size: 0.75rem;
        color: #64748b;
    }

    .history-actions {
        display: flex;
        gap: 0.5rem;
    }

    .btn-sm {
        padding: 0.5rem 0.875rem;
        font-size: 0.8125rem;
    }

    .history-actions .btn {
        flex: 1;
    }
</style>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('days').addEventListener('change', function() {
    this.form.submit();
});
</script>
{% endblock %}
